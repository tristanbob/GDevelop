{
  "version": 3,
  "sources": ["../../../../../../../Extensions/BitmapText/bitmaptextruntimeobject-pixi-renderer.ts"],
  "sourcesContent": ["namespace gdjs {\n  import PIXI = GlobalPIXIModule.PIXI;\n\n  /**\n   * The PIXI.js renderer for the Bitmap Text runtime object.\n   */\n  export class BitmapTextRuntimeObjectPixiRenderer {\n    _object: gdjs.BitmapTextRuntimeObject;\n    _pixiObject: PIXI.BitmapText;\n\n    /**\n     * @param runtimeObject The object to render\n     * @param instanceContainer The container in which the object is\n     */\n    constructor(\n      runtimeObject: gdjs.BitmapTextRuntimeObject,\n      instanceContainer: gdjs.RuntimeInstanceContainer\n    ) {\n      this._object = runtimeObject;\n\n      // Obtain the bitmap font to use in the object.\n      const bitmapFont = instanceContainer\n        .getGame()\n        .getBitmapFontManager()\n        .obtainBitmapFont(\n          runtimeObject._bitmapFontResourceName,\n          runtimeObject._textureAtlasResourceName\n        );\n      this._pixiObject = new PIXI.BitmapText(runtimeObject._text, {\n        fontName: bitmapFont.font,\n        fontSize: bitmapFont.size,\n      });\n\n      // Set the object on the scene\n      instanceContainer\n        .getLayer('')\n        .getRenderer()\n        .addRendererObject(this._pixiObject, runtimeObject.getZOrder());\n\n      // Set the anchor in the center, so that the object rotates around\n      // its center.\n      // @ts-ignore\n      this._pixiObject.anchor.x = 0.5;\n      // @ts-ignore\n      this._pixiObject.anchor.y = 0.5;\n\n      this.updateAlignment();\n      this.updateTextContent();\n      this.updateAngle();\n      this.updateOpacity();\n      this.updateScale();\n      this.updateWrappingWidth();\n      this.updateTint();\n    }\n\n    getRendererObject() {\n      return this._pixiObject;\n    }\n\n    onDestroy() {\n      // Mark the font from the object as not used anymore.\n      this._object\n        .getInstanceContainer()\n        .getGame()\n        .getBitmapFontManager()\n        .releaseBitmapFont(this._pixiObject.fontName);\n\n      this._pixiObject.destroy();\n    }\n\n    getFontSize() {\n      return this._pixiObject.fontSize;\n    }\n\n    updateFont(): void {\n      // Get the new bitmap font to use\n      const bitmapFont = this._object\n        .getInstanceContainer()\n        .getGame()\n        .getBitmapFontManager()\n        .obtainBitmapFont(\n          this._object._bitmapFontResourceName,\n          this._object._textureAtlasResourceName\n        );\n\n      // Mark the old font as not used anymore\n      this._object\n        .getInstanceContainer()\n        .getGame()\n        .getBitmapFontManager()\n        .releaseBitmapFont(this._pixiObject.fontName);\n\n      // Update the font used by the object:\n      this._pixiObject.fontName = bitmapFont.font;\n      this._pixiObject.fontSize = bitmapFont.size;\n      this.updatePosition();\n    }\n\n    updateTint(): void {\n      this._pixiObject.tint = gdjs.rgbToHexNumber(\n        this._object._tint[0],\n        this._object._tint[1],\n        this._object._tint[2]\n      );\n      this._pixiObject.dirty = true;\n    }\n\n    /**\n     * Get the tint of the bitmap object as a \"R;G;B\" string.\n     * @returns the tint of bitmap object in \"R;G;B\" format.\n     */\n    getTint(): string {\n      return (\n        this._object._tint[0] +\n        ';' +\n        this._object._tint[1] +\n        ';' +\n        this._object._tint[2]\n      );\n    }\n\n    updateScale(): void {\n      this._pixiObject.scale.set(Math.max(this._object._scale, 0));\n      this.updatePosition();\n    }\n\n    getScale() {\n      return Math.max(this._pixiObject.scale.x, this._pixiObject.scale.y);\n    }\n\n    updateWrappingWidth(): void {\n      if (this._object._wordWrap) {\n        this._pixiObject.maxWidth =\n          this._object._wrappingWidth / this._object._scale;\n        this._pixiObject.dirty = true;\n      } else {\n        this._pixiObject.maxWidth = 0;\n        this._pixiObject.dirty = true;\n      }\n      this.updatePosition();\n    }\n\n    updateTextContent(): void {\n      this._pixiObject.text = this._object._text;\n      this.updatePosition();\n    }\n\n    updateAlignment(): void {\n      // @ts-ignore - assume align is always a valid value.\n      this._pixiObject.align = this._object._align;\n      this.updatePosition();\n    }\n\n    updatePosition(): void {\n      this._pixiObject.position.x = this._object.x + this.getWidth() / 2;\n      this._pixiObject.position.y = this._object.y + this.getHeight() / 2;\n    }\n\n    updateAngle(): void {\n      this._pixiObject.rotation = gdjs.toRad(this._object.angle);\n    }\n\n    updateOpacity(): void {\n      this._pixiObject.alpha = this._object._opacity / 255;\n    }\n\n    getWidth(): float {\n      return this._pixiObject.textWidth * this.getScale();\n    }\n\n    getHeight(): float {\n      return this._pixiObject.textHeight * this.getScale();\n    }\n  }\n  export const BitmapTextRuntimeObjectRenderer = BitmapTextRuntimeObjectPixiRenderer;\n}\n"],
  "mappings": "AAAA,GAAU,MAAV,UAAU,EAAV,CACE,KAAO,GAAO,iBAAiB,KAKxB,OAA0C,CAQ/C,YACE,EACA,EACA,CACA,KAAK,QAAU,EAGf,KAAM,GAAa,EAChB,UACA,uBACA,iBACC,EAAc,wBACd,EAAc,2BAElB,KAAK,YAAc,GAAI,GAAK,WAAW,EAAc,MAAO,CAC1D,SAAU,EAAW,KACrB,SAAU,EAAW,OAIvB,EACG,SAAS,IACT,cACA,kBAAkB,KAAK,YAAa,EAAc,aAKrD,KAAK,YAAY,OAAO,EAAI,GAE5B,KAAK,YAAY,OAAO,EAAI,GAE5B,KAAK,kBACL,KAAK,oBACL,KAAK,cACL,KAAK,gBACL,KAAK,cACL,KAAK,sBACL,KAAK,aAGP,mBAAoB,CAClB,MAAO,MAAK,YAGd,WAAY,CAEV,KAAK,QACF,uBACA,UACA,uBACA,kBAAkB,KAAK,YAAY,UAEtC,KAAK,YAAY,UAGnB,aAAc,CACZ,MAAO,MAAK,YAAY,SAG1B,YAAmB,CAEjB,KAAM,GAAa,KAAK,QACrB,uBACA,UACA,uBACA,iBACC,KAAK,QAAQ,wBACb,KAAK,QAAQ,2BAIjB,KAAK,QACF,uBACA,UACA,uBACA,kBAAkB,KAAK,YAAY,UAGtC,KAAK,YAAY,SAAW,EAAW,KACvC,KAAK,YAAY,SAAW,EAAW,KACvC,KAAK,iBAGP,YAAmB,CACjB,KAAK,YAAY,KAAO,EAAK,eAC3B,KAAK,QAAQ,MAAM,GACnB,KAAK,QAAQ,MAAM,GACnB,KAAK,QAAQ,MAAM,IAErB,KAAK,YAAY,MAAQ,GAO3B,SAAkB,CAChB,MACE,MAAK,QAAQ,MAAM,GACnB,IACA,KAAK,QAAQ,MAAM,GACnB,IACA,KAAK,QAAQ,MAAM,GAIvB,aAAoB,CAClB,KAAK,YAAY,MAAM,IAAI,KAAK,IAAI,KAAK,QAAQ,OAAQ,IACzD,KAAK,iBAGP,UAAW,CACT,MAAO,MAAK,IAAI,KAAK,YAAY,MAAM,EAAG,KAAK,YAAY,MAAM,GAGnE,qBAA4B,CAC1B,AAAI,KAAK,QAAQ,UACf,MAAK,YAAY,SACf,KAAK,QAAQ,eAAiB,KAAK,QAAQ,OAC7C,KAAK,YAAY,MAAQ,IAEzB,MAAK,YAAY,SAAW,EAC5B,KAAK,YAAY,MAAQ,IAE3B,KAAK,iBAGP,mBAA0B,CACxB,KAAK,YAAY,KAAO,KAAK,QAAQ,MACrC,KAAK,iBAGP,iBAAwB,CAEtB,KAAK,YAAY,MAAQ,KAAK,QAAQ,OACtC,KAAK,iBAGP,gBAAuB,CACrB,KAAK,YAAY,SAAS,EAAI,KAAK,QAAQ,EAAI,KAAK,WAAa,EACjE,KAAK,YAAY,SAAS,EAAI,KAAK,QAAQ,EAAI,KAAK,YAAc,EAGpE,aAAoB,CAClB,KAAK,YAAY,SAAW,EAAK,MAAM,KAAK,QAAQ,OAGtD,eAAsB,CACpB,KAAK,YAAY,MAAQ,KAAK,QAAQ,SAAW,IAGnD,UAAkB,CAChB,MAAO,MAAK,YAAY,UAAY,KAAK,WAG3C,WAAmB,CACjB,MAAO,MAAK,YAAY,WAAa,KAAK,YArKvC,EAAM,sCAwKA,kCAAkC,IA9KvC",
  "names": []
}
