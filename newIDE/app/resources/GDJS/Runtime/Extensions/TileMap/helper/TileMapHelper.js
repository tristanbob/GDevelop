(function(C,U){typeof exports=="object"&&typeof module!="undefined"?U(exports):typeof define=="function"&&define.amd?define(["exports"],U):U((C=typeof globalThis!="undefined"?globalThis:C||self).TileMapHelper={})})(this,function(C){"use strict";var U=function(e,t){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},U(e,t)};function _t(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}U(e,t),e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}function S(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function N(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r,n,o=i.call(e),l=[];try{for(;(t===void 0||t-- >0)&&!(r=o.next()).done;)l.push(r.value)}catch(s){n={error:s}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return l}function X(e,t,i){if(i||arguments.length===2)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}var z,et=2147483648,it=1073741824,rt=536870912;function ct(e){var t=z.isFlippedDiagonally(e),i=z.isFlippedHorizontally(e),r=z.isFlippedVertically(e),n=0;return t?(n=10,!i&&r?n=2:i&&!r?n=6:i&&r&&(n=14)):(n=0,!i&&r?n=8:i&&!r?n=12:i&&r&&(n=4)),n}function Ht(e,t,i,r){var n=e;return t&&(n|=et),i&&(n|=it),r&&(n|=rt),n}(function(e){e.tileIdMask=536870911,e.getTileId=function(t){return t&e.tileIdMask},e.setFlippedHorizontally=function(t,i){return t&=2147483647,i&&(t|=et),t},e.setFlippedVertically=function(t,i){return t&=-1073741825,i&&(t|=it),t},e.setFlippedDiagonally=function(t,i){return t&=-536870913,i&&(t|=rt),t},e.isFlippedHorizontally=function(t){return(t&et)!=0},e.isFlippedVertically=function(t){return(t&it)!=0},e.isFlippedDiagonally=function(t){return(t&rt)!=0}})(z||(z={}));var dt=function(){function e(t,i,r,n,o){this.tileWidth=t,this.tileHeight=i,this.dimX=r,this.dimY=n,this._tileSet=o,this._layers=[]}return e.prototype.getWidth=function(){return this.tileWidth*this.dimX},e.prototype.getHeight=function(){return this.tileHeight*this.dimY},e.prototype.getTileHeight=function(){return this.tileHeight},e.prototype.getTileWidth=function(){return this.tileWidth},e.prototype.getDimensionX=function(){return this.dimX},e.prototype.getDimensionY=function(){return this.dimY},e.prototype.getTileDefinition=function(t){return this._tileSet.get(t)},e.prototype.getTileDefinitions=function(){return this._tileSet.values()},e.prototype.addTileLayer=function(t){var i=new nt(this,t);return this._layers.push(i),i},e.prototype.addObjectLayer=function(t){var i=new wt(this,t);return this._layers.push(i),i},e.prototype.getBackgroundResourceName=function(){return this._backgroundResourceName},e.prototype.getLayers=function(){return this._layers},e.prototype.pointIsInsideTile=function(t,i,r){var n,o,l=Math.floor(t/this.tileWidth),s=Math.floor(i/this.tileHeight);try{for(var p=S(this._layers),a=p.next();!a.done;a=p.next()){var c=a.value;if(c){var d=c.getTileId(l,s);if(d===void 0)return!1;if(this._tileSet.get(d).hasTaggedHitBox(r))return!0}}}catch(u){n={error:u}}finally{try{a&&!a.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}return!1},e.prototype.setBackgroundResourceName=function(t){this._backgroundResourceName=t},e}(),bt=function(){function e(t,i){this.visible=!0,this.tileMap=t,this.id=i}return e.prototype.setVisible=function(t){this.visible=t},e.prototype.isVisible=function(){return this.visible},e}(),wt=function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.objects=[],n}return _t(t,e),t.prototype.add=function(i){this.objects.push(i)},t}(bt),Dt=function(){function e(t,i,r){this.tileId=r,this.x=t,this.y=i}return e.prototype.getTileId=function(){return z.getTileId(this.tileId)},e.prototype.setFlippedHorizontally=function(t){this.tileId=z.setFlippedHorizontally(this.tileId,t)},e.prototype.setFlippedVertically=function(t){this.tileId=z.setFlippedVertically(this.tileId,t)},e.prototype.setFlippedDiagonally=function(t){this.tileId=z.setFlippedDiagonally(this.tileId,t)},e.prototype.isFlippedHorizontally=function(){return z.isFlippedHorizontally(this.tileId)},e.prototype.isFlippedVertically=function(){return z.isFlippedVertically(this.tileId)},e.prototype.isFlippedDiagonally=function(){return z.isFlippedDiagonally(this.tileId)},e}(),nt=function(e){function t(i,r){var n=e.call(this,i,r)||this;n._tiles=[],n._tiles.length=n.tileMap.getDimensionY();for(var o=0;o<n._tiles.length;o++)n._tiles[o]=new Int32Array(n.tileMap.getDimensionX());return n._alpha=1,n}return _t(t,e),t.prototype.getAlpha=function(){return this._alpha},t.prototype.setAlpha=function(i){this._alpha=i},t.prototype.setTile=function(i,r,n){if(this.tileMap.getTileDefinition(n)){var o=this._tiles[r];!o||i>=o.length||(o[i]=n+1)}else console.error("Invalid tile definition index: ".concat(n))},t.prototype.removeTile=function(i,r){var n=this._tiles[r];!n||i>=n.length||(n[i]=0)},t.prototype.setFlippedHorizontally=function(i,r,n){var o=this._tiles[r];if(o&&!(i>=o.length)){var l=o[i];l!==0&&(o[i]=z.setFlippedHorizontally(l,n))}},t.prototype.setFlippedVertically=function(i,r,n){var o=this._tiles[r];if(o&&!(i>=o.length)){var l=o[i];l!==0&&(o[i]=z.setFlippedVertically(l,n))}},t.prototype.setFlippedDiagonally=function(i,r,n){var o=this._tiles[r];if(o&&!(i>=o.length)){var l=o[i];l!==0&&(o[i]=z.setFlippedDiagonally(l,n))}},t.prototype.isFlippedHorizontally=function(i,r){var n=this._tiles[r];return!(!n||i>=n.length)&&z.isFlippedHorizontally(n[i])},t.prototype.isFlippedVertically=function(i,r){var n=this._tiles[r];return!(!n||i>=n.length)&&z.isFlippedVertically(n[i])},t.prototype.isFlippedDiagonally=function(i,r){var n=this._tiles[r];return!(!n||i>=n.length)&&z.isFlippedDiagonally(n[i])},t.prototype.getTileGID=function(i,r){var n=this._tiles[r];if(n&&!(i>=n.length)&&n[i]!==0)return n[i]-1},t.prototype.getTileId=function(i,r){var n=this._tiles[r];if(n&&!(i>=n.length)&&n[i]!==0)return z.getTileId(n[i]-1)},t.prototype.getDimensionX=function(){return this._tiles.length===0?0:this._tiles[0].length},t.prototype.getDimensionY=function(){return this._tiles.length},t.prototype.getWidth=function(){return this.tileMap.getWidth()},t.prototype.getHeight=function(){return this.tileMap.getHeight()},t}(bt),Q=function(){function e(t){this.taggedHitBoxes=[],this.animationLength=t??0,this.stackedTiles=[]}return e.prototype.addHitBox=function(t,i){var r=this.taggedHitBoxes.find(function(n){return n.tag===t});r||(r={tag:t,polygons:[]},this.taggedHitBoxes.push(r)),r.polygons.push(i)},e.prototype.hasTaggedHitBox=function(t){return this.taggedHitBoxes.some(function(i){return i.tag===t})},e.prototype.getHitBoxes=function(t){var i=this.taggedHitBoxes.find(function(r){return r.tag===t});return i&&i.polygons},e.prototype.getAnimationLength=function(){return this.animationLength},e.prototype.getStackTileId=function(){return this.stackTileId},e.prototype.getStackedTiles=function(){return this.stackedTiles},e.prototype.hasStackedTiles=function(){return this.stackedTiles.length>0},e.prototype.setStackedTiles=function(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];this.stackedTiles=i,this.stackTileId=t},e}(),mt=function(){function e(){this._cachedValues=new Map,this._callbacks=new Map}return e.prototype.getOrLoad=function(t,i,r){var n=this,o=this._cachedValues.get(t);if(o)r(o);else{var l=this._callbacks.get(t);l?l.push(r):(this._callbacks.set(t,[r]),i(function(s){var p,a;s&&n._cachedValues.set(t,s);var c=n._callbacks.get(t);n._callbacks.delete(t);try{for(var d=S(c),u=d.next();!u.done;u=d.next())(0,u.value)(s)}catch(w){p={error:w}}finally{try{u&&!u.done&&(a=d.return)&&a.call(d)}finally{if(p)throw p.error}}}))}},e}(),ut=function(){function e(){this._levelBackgroundTextures=new Map,this._textures=new Map}return e.prototype.setTexture=function(t,i){this._textures.set(t,i)},e.prototype.getTexture=function(t){return this._textures.get(t)},e.prototype.getLevelBackgroundTexture=function(t){return this._levelBackgroundTextures.get(t)},e.prototype.setLevelBackgroundTexture=function(t,i){this._levelBackgroundTextures.set(t,i)},e}(),At=function(e,t){var i=t.data,r=t.compression;if(!i)return i;var n=4,o=[],l=atob(i).split("").map(function(c){return c.charCodeAt(0)});try{var s=function(c,d){return c[d]+(c[d+1]<<8)+(c[d+2]<<16)+(c[d+3]<<24)>>>0};if(r==="zlib")for(var p=new Uint8Array(l),a=e.inflate(p);n<=a.length;)o.push(s(a,n-4)),n+=4;else{if(r==="zstd")return console.error("Zstandard compression is not supported for layers in a Tilemap. Use instead zlib compression or no compression."),null;for(;n<=l.length;)o.push(s(l,n-4)),n+=4}return o}catch(c){return console.error("Failed to decompress and unzip base64 layer.data string",c),null}},kt=function(e){var t=e&et,i=e&it,r=e&rt;return{id:ot(536870911&e),flippedHorizontally:!!t,flippedVertically:!!i,flippedDiagonally:!!r}};function ot(e){return e===0?void 0:e-1}var pt,It=GlobalPIXIModule.PIXI;function ft(e,t){var i=e<<16;return i+=t}(function(e){e.parseAtlas=function(t,i,r,n){if(!t.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;if(!t.tilesets.length||"source"in t.tilesets[0])return console.warn("The loaded Tiled map seems not to contain any tileset data (nothing in 'tilesets' key)."),null;var o=t.tilesets[0],l=o.tilewidth,s=o.tileheight,p=o.tilecount,a=o.image,c=o.columns,d=o.spacing,u=o.margin,w=o.firstgid===void 0?1:o.firstgid;r||(r=n(a));var A=p/c,m=l*c+d*(c-1)+2*u,g=s*A+d*(A-1)+2*u;if(r.width<m||r.height<g)return console.error("It seems the atlas file was resized, which is not supported. "+"It should be ".concat(m,"x").concat(g," px, ")+"but it's actually ".concat(r.width,"x").concat(r.height," px.")),null;r.width===m&&r.height===g||console.warn("It seems the atlas file has unused pixels. "+"It should be ".concat(m,"x").concat(g," px, ")+"but it's actually ".concat(r.width,"x").concat(r.height," px."));for(var _=new ut,f=0;f<p;f++){var T=u+Math.floor(f%c)*(l+d),H=u+Math.floor(f/c)*(s+d),I=ot(w+f);try{var h=new It.Rectangle(T,H,l,s),B=new It.Texture(r,h);_.setTexture(I,B)}catch(x){console.error("An error occurred while creating a PIXI.Texture to be used in a TileMap:",x)}}return _}})(pt||(pt={}));var ht,yt,gt,vt,Tt,lt=GlobalPIXIModule.PIXI;function Ft(e,t,i,r){var n;if(e[r])return e[r];var o=null,l=t[r];return(l==null?void 0:l.relPath)?((n=(o=i(l.relPath)).baseTexture)===null||n===void 0?void 0:n.cacheId)==="res/error48.png"&&(console.error('The atlas texture "'.concat(l.relPath,`" can't be loaded`)),o=null):console.error('The tileset "'.concat(l.identifier,`" doesn't seems to contain an atlas texture`)),e[r]=o,o}(function(e){e.parseAtlas=function(t,i,r,n){var o,l,s,p,a=t.levels[i>-1?i:0];if(!a||!a.layerInstances)return null;var c={};try{for(var d=S(t.defs.tilesets),u=d.next();!u.done;u=d.next())c[(T=u.value).uid]=T}catch(M){o={error:M}}finally{try{u&&!u.done&&(l=d.return)&&l.call(d)}finally{if(o)throw o.error}}for(var w=new ut,A={},m={},g=a.layerInstances.length-1;g>=0;--g){var _=a.layerInstances[g];if(_.__type!=="Entities"){var f=_.__tilesetDefUid;if(typeof f=="number"){var T=c[f],H=Ft(m,c,n,f);if(H){var I={},h=T.tileGridSize;try{for(var B=(s=void 0,S(X(X([],N(_.autoLayerTiles),!1),N(_.gridTiles),!1))),x=B.next();!x.done;x=B.next()){var P=x.value;if(!I[P.t]){var W=ft(f,P.t);if(A[W])I[P.t]=!0;else{try{var b=N(P.src,2),L=b[0],k=b[1],F=new lt.Rectangle(L,k,h,h),D=new lt.Texture(H,F);w.setTexture(W,D)}catch(M){console.error("An error occurred while creating a PIXI.Texture to be used in a TileMap:",M)}I[P.t]=!0,A[W]=!0}}}}catch(M){s={error:M}}finally{try{x&&!x.done&&(p=B.return)&&p.call(B)}finally{if(s)throw s.error}}}}}}if(a.bgRelPath){var v=n(a.bgRelPath);F=new lt.Rectangle(0,0,a.pxWid,a.pxHei),D=new lt.Texture(v,F),w.setLevelBackgroundTexture(a.bgRelPath,D)}return w}})(ht||(ht={})),C.PixiTileMapHelper=void 0,(yt=C.PixiTileMapHelper||(C.PixiTileMapHelper={})).parseAtlas=function(e,t,i,r){return e.kind==="ldtk"?ht.parseAtlas(e.data,t,i,r):e.kind==="tiled"?pt.parseAtlas(e.data,t,i,r):(console.warn("The loaded Tiled map data does not contain a 'tiledversion' or '__header__' key. Are you sure this file has been exported from Tiled (mapeditor.org) or LDtk (ldtk.io)?"),null)},yt.updatePixiTileMap=function(e,t,i,r,n){var o,l,s,p,a,c,d=e;if(d){d.clear();var u=t.getBackgroundResourceName();if(u){var w=i.getLevelBackgroundTexture(u);d.tile(w,0,0)}try{for(var A=S(t.getLayers()),m=A.next();!m.done;m=A.next()){var g=m.value;if(!(r==="index"&&n!==g.id||r==="visible"&&!g.isVisible())){if(g instanceof wt){var _=g;try{for(var f=(s=void 0,S(_.objects)),T=f.next();!T.done;T=f.next()){var H=T.value,I=H.getTileId();if(w=i.getTexture(I)){var h=ct(I);d.tile(w,H.x,H.y-_.tileMap.getTileHeight(),{rotate:h})}}}catch(G){s={error:G}}finally{try{T&&!T.done&&(p=f.return)&&p.call(f)}finally{if(s)throw s.error}}}else if(g instanceof nt)for(var B=g,x=B.tileMap.getTileWidth(),P=B.tileMap.getTileHeight(),W=B.tileMap.getDimensionX(),b=B.tileMap.getDimensionY(),L=B.getAlpha(),k=0;k<b;k++)for(var F=0;F<W;F++){var D=x*F,v=P*k;if((I=B.getTileGID(F,k))!==void 0){var M=z.getTileId(I),V=B.tileMap.getTileDefinition(M);if(V.hasStackedTiles())try{for(var j=(a=void 0,S(V.getStackedTiles())),R=j.next();!R.done;R=j.next()){var Y=R.value,E=z.getTileId(Y);(J=i.getTexture(E))&&(h=ct(Y),d.tile(J,D,v,{alpha:L,rotate:h}))}}catch(G){a={error:G}}finally{try{R&&!R.done&&(c=j.return)&&c.call(j)}finally{if(a)throw a.error}}else{var J;if(!(J=i.getTexture(M))){console.warn("Unknown tile id: ".concat(M," at (").concat(F,", ").concat(k,")"));continue}h=ct(I);var $=d.tile(J,D,v,{alpha:L,rotate:h});V.getAnimationLength()>0&&$.tileAnimX(x,V.getAnimationLength())}}}}}}catch(G){o={error:G}}finally{try{m&&!m.done&&(l=A.return)&&l.call(A)}finally{if(o)throw o.error}}}},yt.updatePixiCollisionMask=function(e,t,i,r,n,o,l,s){var p,a,c,d;if(e){e.clear(),e.lineStyle(r,n,o),e.drawRect(0,0,t.getWidth(),t.getHeight());try{for(var u=S(t.getLayers()),w=u.next();!w.done;w=u.next()){var A=w.value,m=t.getTileWidth(),g=t.getTileHeight();if(A instanceof nt)for(var _=A,f=0;f<_.tileMap.getDimensionY();f++)for(var T=0;T<_.tileMap.getDimensionX();T++){var H=m*T,I=g*f,h=_.getTileId(T,f),B=_.isFlippedHorizontally(T,f),x=_.isFlippedVertically(T,f),P=_.isFlippedDiagonally(T,f),W=_.tileMap.getTileDefinition(h);if(W){var b=W.getHitBoxes(i);if(b)try{for(var L=(c=void 0,S(b)),k=L.next();!k.done;k=L.next()){var F=k.value;if(F.length!==0){e.beginFill(l,s);for(var D=0;D<F.length;D++){var v=F[D][0],M=F[D][1];if(P){var V=v;v=M,M=V}B&&(v=m-v),x&&(M=g-M),D===0?e.moveTo(H+v,I+M):e.lineTo(H+v,I+M)}e.closePath(),e.endFill()}}}catch(j){c={error:j}}finally{try{k&&!k.done&&(d=L.return)&&d.call(L)}finally{if(c)throw c.error}}}}}}catch(j){p={error:j}}finally{try{w&&!w.done&&(a=u.return)&&a.call(u)}finally{if(p)throw p.error}}}},function(e){e.load=function(t,i){var r,n,o,l,s=t.levels[i>-1?i:0];if(!s||!s.layerInstances)return null;for(var p=new Map,a=0,c=0,d=0,u=s.layerInstances.length-1;u>=0;--u){var w=(h=s.layerInstances[u]).__tilesetDefUid,A={};try{for(var m=(r=void 0,S(X(X([],N(h.autoLayerTiles),!1),N(h.gridTiles),!1))),g=m.next();!g.done;g=m.next())if(!A[(b=g.value).t]){var _=ft(w,b.t);if(p.has(_))A[b.t]=!0;else{var f=new Q(0);A[b.t]=!0,p.set(_,f)}}}catch(R){r={error:R}}finally{try{g&&!g.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}h.__type!=="IntGrid"&&h.__type!=="AutoLayer"&&h.__type!=="Tiles"||(a===0?(a=h.__gridSize,c=h.__cWid,d=h.__cHei):h.__gridSize!==a&&console.warn("Grid size is different across layers. Only the first layer grid size will be followed."))}var T=new dt(a,a,c,d,p),H=new Map,I=268435455;for(u=s.layerInstances.length-1;u>=0;--u){var h,B=(h=s.layerInstances[u]).__gridSize,x=(w=h.__tilesetDefUid,T.addTileLayer(u));x.setAlpha(h.__opacity),x.setVisible(h.visible);try{for(var P=(o=void 0,S(X(X([],N(h.autoLayerTiles),!1),N(h.gridTiles),!1))),W=P.next();!W.done;W=P.next()){var b=W.value,L=Math.floor(b.px[0]/B),k=Math.floor(b.px[1]/B),F=(_=ft(w,b.t),x.getTileId(L,k));if(F===void 0)x.setTile(L,k,_),x.setFlippedHorizontally(L,k,b.f===1||b.f===3),x.setFlippedVertically(L,k,b.f===2||b.f===3);else{var D=Ht(_,b.f===1||b.f===3,b.f===2||b.f===3,!1),v=p.get(F);if(v==null?void 0:v.hasStackedTiles()){var M="".concat(v.getStackedTiles().map(function(R){return"".concat(R)}).join(";"),";").concat(D);if(f=H.get(M))x.setTile(L,k,f.getStackTileId());else{var V=new Q(0);V.setStackedTiles.apply(V,X(X([I],N(v.getStackedTiles()),!1),[D],!1)),p.set(I,V),I-=1,H.set(M,V),x.setTile(L,k,V.getStackTileId())}}else{var j=x.getTileGID(L,k);M="".concat(j,";").concat(D),(f=new Q(0)).setStackedTiles(I,j,D),p.set(I,f),I-=1,H.set(M,f),x.setTile(L,k,f.getStackTileId())}}}}catch(R){o={error:R}}finally{try{W&&!W.done&&(l=P.return)&&l.call(P)}finally{if(o)throw o.error}}}return s.bgRelPath&&T.setBackgroundResourceName(s.bgRelPath),T}}(gt||(gt={})),function(e){e.load=function(t,i){var r,n,o,l,s,p,a,c,d,u;if(!t.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;var w=new Map;try{for(var A=S(t.tilesets),m=A.next();!m.done;m=A.next()){var g=m.value,_=g.firstgid===void 0?1:g.firstgid;if(g.tiles)try{for(var f=(o=void 0,S(g.tiles)),T=f.next();!T.done;T=f.next()){var H=T.value,I=new Q(H.animation?H.animation.length:0),h=H.type||H.class;if(H.objectgroup){var B=function(y){var xt=y.type||y.class||h;if(!xt||xt.length===0)return"continue";var at=null;if(y.polygon){var Mt=y.rotation*Math.PI/180,q=Math.cos(Mt),tt=Math.sin(Mt);q!==-1&&q!==1||(tt=0),tt!==-1&&tt!==1||(q=0),at=y.polygon.map(function(st){return[y.x+st.x*q-st.y*tt,y.y+st.x*tt+st.y*q]})}else y.x!==void 0&&y.y!==void 0&&y.width!==void 0&&y.height!==void 0&&(at=[[y.x,y.y],[y.x,y.y+y.height],[y.x+y.width,y.y+y.height],[y.x+y.width,y.y]]);at&&I.addHitBox(xt,at)};try{for(var x=(s=void 0,S(H.objectgroup.objects)),P=x.next();!P.done;P=x.next())B(E=P.value)}catch(y){s={error:y}}finally{try{P&&!P.done&&(p=x.return)&&p.call(x)}finally{if(s)throw s.error}}}else if(h){var W=[[0,0],[0,t.tileheight],[t.tilewidth,t.tileheight],[t.tilewidth,0]];I.addHitBox(h,W)}w.set(ot(_+H.id),I)}}catch(y){o={error:y}}finally{try{T&&!T.done&&(l=f.return)&&l.call(f)}finally{if(o)throw o.error}}for(var b=0;b<g.tilecount;b++){var L=ot(_+b);w.has(L)||w.set(L,new Q(0))}}}catch(y){r={error:y}}finally{try{m&&!m.done&&(n=A.return)&&n.call(A)}finally{if(r)throw r.error}}var k=new dt(t.tilewidth,t.tileheight,t.width,t.height,w);try{for(var F=S(t.layers),D=F.next();!D.done;D=F.next()){var v=D.value;if(v.type==="objectgroup"){var M=k.addObjectLayer(v.id);M.setVisible(v.visible);try{for(var V=(d=void 0,S(v.objects)),j=V.next();!j.done;j=V.next()){var R=j.value;if(R.visible&&R.gid){var Y=kt(R.gid),E=new Dt(R.x,R.y,Y.id);M.add(E),E.setFlippedHorizontally(Y.flippedHorizontally),E.setFlippedVertically(Y.flippedVertically),E.setFlippedDiagonally(Y.flippedDiagonally)}}}catch(y){d={error:y}}finally{try{j&&!j.done&&(u=V.return)&&u.call(V)}finally{if(d)throw d.error}}}else if(v.type==="tilelayer"){var J=0,$=null;if(v.encoding==="base64"?($=At(i,v))||console.warn("Failed to uncompress layer.data"):$=v.data,$){var G=k.addTileLayer(v.id);G.setAlpha(v.opacity),G.setVisible(v.visible);for(var O=0;O<v.height;O++)for(var K=0;K<v.width;K++){var Bt=$[J],Z=kt(Bt);Z.id!==void 0&&(G.setTile(K,O,Z.id),G.setFlippedHorizontally(K,O,Z.flippedHorizontally),G.setFlippedVertically(K,O,Z.flippedVertically),G.setFlippedDiagonally(K,O,Z.flippedDiagonally)),J+=1}}}}}catch(y){a={error:y}}finally{try{D&&!D.done&&(c=F.return)&&c.call(F)}finally{if(a)throw a.error}}return k}}(vt||(vt={})),function(e){e.load=function(t,i,r){return t.kind==="ldtk"?gt.load(t.data,i):t.kind==="tiled"?vt.load(t.data,r):(console.warn("The loaded Tile Map data does not contain a 'tiledversion' or '__header__' key. Are you sure this file has been exported from Tiled (mapeditor.org) or LDtk (ldtk.io)?"),null)}}(Tt||(Tt={}));var zt=function(){function e(){this._tileMapCache=new mt,this._textureCacheCaches=new mt}return e.getManager=function(t){return t.tileMapCollisionMaskManager||(t.tileMapCollisionMaskManager=new e),t.tileMapCollisionMaskManager},e.identify=function(t){return t.tiledversion?(console.info("Detected the json file was created in Tiled"),{kind:"tiled",data:t}):t.__header__&&t.__header__.app==="LDtk"?(console.info("Detected the json/ldtk file was created in LDtk"),{kind:"ldtk",data:t}):(console.warn("The loaded Tile Map data does not contain a 'tiledversion' or '__header__' key. Are you sure this file has been exported from Tiled (mapeditor.org) or LDtk (ldtk.io)?"),null)},e.prototype.getOrLoadTileMap=function(t,i,r,n,o,l){var s=i+"|"+r+"|"+n;this._tileMapCache.getOrLoad(s,function(p){t(i,r,function(a){if(a){var c=Tt.load(a,n,o);p(c)}else p(null)})},l)},e.prototype.getOrLoadTextureCache=function(t,i,r,n,o,l,s){var p=n+"|"+o+"|"+r+"|"+l;this._textureCacheCaches.getOrLoad(p,function(a){t(n,o,function(c){if(c){var d=r?i(r):null,u=C.PixiTileMapHelper.parseAtlas(c,l,d,i);a(u)}else a(null)})},s)},e}();C.EditableTileMap=dt,C.EditableTileMapLayer=nt,C.TileDefinition=Q,C.TileMapManager=zt,C.TileTextureCache=ut,Object.defineProperty(C,"__esModule",{value:!0})});
//# sourceMappingURL=TileMapHelper.js.map
