{
  "version": 3,
  "sources": ["../../../../../../../Extensions/TextObject/textruntimeobject-pixi-renderer.ts"],
  "sourcesContent": ["namespace gdjs {\n  import PIXI = GlobalPIXIModule.PIXI;\n\n  class TextRuntimeObjectPixiRenderer {\n    _object: gdjs.TextRuntimeObject;\n    _fontManager: any;\n    _text: PIXI.Text;\n    _justCreated: boolean = true;\n\n    constructor(\n      runtimeObject: gdjs.TextRuntimeObject,\n      instanceContainer: gdjs.RuntimeInstanceContainer\n    ) {\n      this._object = runtimeObject;\n      this._fontManager = instanceContainer.getGame().getFontManager();\n      this._text = new PIXI.Text(' ', { align: 'left' });\n      this._text.anchor.x = 0.5;\n      this._text.anchor.y = 0.5;\n      instanceContainer\n        .getLayer('')\n        .getRenderer()\n        .addRendererObject(this._text, runtimeObject.getZOrder());\n      this._text.text =\n        runtimeObject._str.length === 0 ? ' ' : runtimeObject._str;\n\n      //Work around a PIXI.js bug. See updateTime method.\n      this.updateStyle();\n      this.updatePosition();\n    }\n\n    getRendererObject() {\n      return this._text;\n    }\n\n    ensureUpToDate() {\n      if (this._justCreated) {\n        //Work around a PIXI.js bug:\n        this._text.updateText(false);\n\n        //Width seems not to be correct when text is not rendered yet.\n        this.updatePosition();\n        this._justCreated = false;\n      }\n    }\n\n    updateStyle(): void {\n      const fontName =\n        '\"' + this._fontManager.getFontFamily(this._object._fontName) + '\"';\n      const style = this._text.style;\n      style.fontStyle = this._object._italic ? 'italic' : 'normal';\n      style.fontWeight = this._object._bold ? 'bold' : 'normal';\n      style.fontSize = this._object._characterSize;\n      style.fontFamily = fontName;\n      if (this._object._useGradient) {\n        style.fill = this._getGradientHex();\n      } else {\n        style.fill = this._getColorHex();\n      }\n      if (this._object._gradientType === 'LINEAR_VERTICAL') {\n        style.fillGradientType = PIXI.TEXT_GRADIENT.LINEAR_VERTICAL;\n      } else {\n        style.fillGradientType = PIXI.TEXT_GRADIENT.LINEAR_HORIZONTAL;\n      }\n      // @ts-ignore\n      style.align = this._object._textAlign;\n      style.wordWrap = this._object._wrapping;\n      style.wordWrapWidth = this._object._wrappingWidth;\n      style.breakWords = true;\n      style.stroke = gdjs.rgbToHexNumber(\n        this._object._outlineColor[0],\n        this._object._outlineColor[1],\n        this._object._outlineColor[2]\n      );\n      style.strokeThickness = this._object._outlineThickness;\n      style.dropShadow = this._object._shadow;\n      style.dropShadowColor = gdjs.rgbToHexNumber(\n        this._object._shadowColor[0],\n        this._object._shadowColor[1],\n        this._object._shadowColor[2]\n      );\n      style.dropShadowBlur = this._object._shadowBlur;\n      style.dropShadowAngle = this._object._shadowAngle;\n      style.dropShadowDistance = this._object._shadowDistance;\n      style.padding = this._object._padding;\n\n      // Prevent spikey outlines by adding a miter limit\n      style.miterLimit = 3;\n      this.updatePosition();\n\n      // Manually ask the PIXI object to re-render as we changed a style property\n      // see http://www.html5gamedevs.com/topic/16924-change-text-style-post-render/\n      // @ts-ignore\n      this._text.dirty = true;\n    }\n\n    updatePosition(): void {\n      if (this._object.isWrapping()) {\n        const alignmentX =\n          this._object._textAlign === 'right'\n            ? 1\n            : this._object._textAlign === 'center'\n            ? 0.5\n            : 0;\n\n        const width = this._object.getWrappingWidth();\n\n        // A vector from the custom size center to the renderer center.\n        const centerToCenterX = (width - this._text.width) * (alignmentX - 0.5);\n\n        this._text.position.x = this._object.x + width / 2;\n        this._text.anchor.x = 0.5 - centerToCenterX / this._text.width;\n      } else {\n        this._text.position.x = this._object.x + this._text.width / 2;\n        this._text.anchor.x = 0.5;\n      }\n      this._text.position.y = this._object.y + this._text.height / 2;\n    }\n\n    updateAngle(): void {\n      this._text.rotation = gdjs.toRad(this._object.angle);\n    }\n\n    updateOpacity(): void {\n      this._text.alpha = this._object.opacity / 255;\n    }\n\n    updateString(): void {\n      this._text.text =\n        this._object._str.length === 0 ? ' ' : this._object._str;\n\n      //Work around a PIXI.js bug.\n      this._text.updateText(false);\n    }\n\n    getWidth(): float {\n      return this._text.width;\n    }\n\n    getHeight(): float {\n      return this._text.height;\n    }\n\n    _getColorHex() {\n      return gdjs.rgbToHexNumber(\n        this._object._color[0],\n        this._object._color[1],\n        this._object._color[2]\n      );\n    }\n\n    _getGradientHex() {\n      const gradient: Array<string> = [];\n      for (\n        let colorIndex = 0;\n        colorIndex < this._object._gradient.length;\n        colorIndex++\n      ) {\n        gradient.push(\n          '#' +\n            gdjs.rgbToHex(\n              this._object._gradient[colorIndex][0],\n              this._object._gradient[colorIndex][1],\n              this._object._gradient[colorIndex][2]\n            )\n        );\n      }\n      return gradient;\n    }\n\n    /**\n     * Get x-scale of the text.\n     */\n    getScaleX(): float {\n      return this._text.scale.x;\n    }\n\n    /**\n     * Get y-scale of the text.\n     */\n    getScaleY(): float {\n      return this._text.scale.y;\n    }\n\n    /**\n     * Set the text object scale.\n     * @param newScale The new scale for the text object.\n     */\n    setScale(newScale: float): void {\n      this._text.scale.x = newScale;\n      this._text.scale.y = newScale;\n    }\n\n    /**\n     * Set the text object x-scale.\n     * @param newScale The new x-scale for the text object.\n     */\n    setScaleX(newScale: float): void {\n      this._text.scale.x = newScale;\n    }\n\n    /**\n     * Set the text object y-scale.\n     * @param newScale The new y-scale for the text object.\n     */\n    setScaleY(newScale: float): void {\n      this._text.scale.y = newScale;\n    }\n  }\n\n  // Register the class to let the engine use it.\n  export const TextRuntimeObjectRenderer = TextRuntimeObjectPixiRenderer;\n  export type TextRuntimeObjectRenderer = TextRuntimeObjectPixiRenderer;\n}\n"],
  "mappings": "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",
  "names": []
}
