{
  "version": 3,
  "sources": ["../../../../../../../Extensions/TextInput/textinputruntimeobject-pixi-renderer.ts"],
  "sourcesContent": ["namespace gdjs {\n  const userFriendlyToHtmlInputTypes = {\n    text: 'text',\n    email: 'email',\n    password: 'password',\n    number: 'number',\n    'telephone number': 'tel',\n    url: 'url',\n    search: 'search',\n  };\n\n  const formatRgbAndOpacityToCssRgba = (\n    rgbColor: [float, float, float],\n    opacity: float\n  ) => {\n    return (\n      'rgba(' +\n      rgbColor[0] +\n      ',' +\n      rgbColor[1] +\n      ',' +\n      rgbColor[2] +\n      ',' +\n      opacity / 255 +\n      ')'\n    );\n  };\n\n  class TextInputRuntimeObjectPixiRenderer {\n    private _object: gdjs.TextInputRuntimeObject;\n    private _input: HTMLInputElement | HTMLTextAreaElement | null = null;\n    private _instanceContainer: gdjs.RuntimeInstanceContainer;\n    private _runtimeGame: gdjs.RuntimeGame;\n\n    constructor(\n      runtimeObject: gdjs.TextInputRuntimeObject,\n      instanceContainer: gdjs.RuntimeInstanceContainer\n    ) {\n      this._object = runtimeObject;\n      this._instanceContainer = instanceContainer;\n      this._runtimeGame = this._instanceContainer.getGame();\n\n      this._createElement();\n    }\n\n    _createElement() {\n      if (!!this._input)\n        throw new Error('Tried to recreate an input while it already exists.');\n\n      const isTextArea = this._object.getInputType() === 'text area';\n      this._input = document.createElement(isTextArea ? 'textarea' : 'input');\n      this._input.style.border = '1px solid black';\n      this._input.autocomplete = 'off';\n      this._input.style.borderRadius = '0px';\n      this._input.style.backgroundColor = 'white';\n      this._input.style.position = 'absolute';\n      this._input.style.resize = 'none';\n      this._input.style.outline = 'none';\n      this._input.style.pointerEvents = 'auto'; // Element can be clicked/touched.\n      this._input.style.display = 'none'; // Hide while object is being set up.\n      this._input.style.boxSizing = 'border-box'; // Important for iOS, because border is added to width/height.\n\n      this._input.addEventListener('input', () => {\n        if (!this._input) return;\n\n        this._object.onRendererInputValueChanged(this._input.value);\n      });\n      this._input.addEventListener('touchstart', () => {\n        if (!this._input) return;\n\n        // Focus directly when touching the input on touchscreens.\n        if (document.activeElement !== this._input) this._input.focus();\n      });\n\n      this.updateString();\n      this.updateFont();\n      this.updatePlaceholder();\n      this.updateOpacity();\n      this.updateInputType();\n      this.updateTextColor();\n      this.updateFillColorAndOpacity();\n      this.updateBorderColorAndOpacity();\n      this.updateBorderWidth();\n      this.updateDisabled();\n      this.updateReadOnly();\n\n      this._runtimeGame\n        .getRenderer()\n        .getDomElementContainer()!\n        .appendChild(this._input);\n    }\n\n    _destroyElement() {\n      if (!this._input) return;\n      this._input.remove();\n      this._input = null;\n    }\n\n    onScenePaused() {\n      // This is the only renderer that uses a DOM element. PixiJS renderers\n      // usually don't need to know if a scene is paused/resumed,\n      // because their renderers are then not used (not part of the other scene graphs).\n      // For this object, we need to remove the DOM element whenever it must\n      // be not rendered.\n      this._destroyElement();\n    }\n\n    onSceneResumed() {\n      this._createElement();\n    }\n\n    onDestroy() {\n      this._destroyElement();\n    }\n\n    updatePreRender() {\n      if (!this._input) return;\n\n      // Hide the input entirely if the object is hidden.\n      // Because this object is rendered as a DOM element (and not part of the PixiJS\n      // scene graph), we have to do this manually.\n      if (this._object.isHidden()) {\n        this._input.style.display = 'none';\n        return;\n      }\n\n      // Hide the input entirely if the layer is not visible.\n      // Because this object is rendered as a DOM element (and not part of the PixiJS\n      // scene graph), we have to do this manually.\n      const layer = this._instanceContainer.getLayer(this._object.getLayer());\n      if (!layer.isVisible()) {\n        this._input.style.display = 'none';\n        return;\n      }\n\n      const workingPoint: FloatPoint = gdjs.staticArray(\n        TextInputRuntimeObjectPixiRenderer.prototype.updatePreRender\n      ) as FloatPoint;\n\n      const runtimeGame = this._instanceContainer.getGame();\n      const runtimeGameRenderer = runtimeGame.getRenderer();\n      const topLeftCanvasCoordinates = layer.convertInverseCoords(\n        this._object.x,\n        this._object.y,\n        0,\n        workingPoint\n      );\n      const canvasLeft = topLeftCanvasCoordinates[0];\n      const canvasTop = topLeftCanvasCoordinates[1];\n\n      const bottomRightCanvasCoordinates = layer.convertInverseCoords(\n        this._object.x + this._object.getWidth(),\n        this._object.y + this._object.getHeight(),\n        0,\n        workingPoint\n      );\n      const canvasRight = bottomRightCanvasCoordinates[0];\n      const canvasBottom = bottomRightCanvasCoordinates[1];\n\n      // Hide the input entirely if not visible at all.\n      const isOutsideCanvas =\n        canvasRight < 0 ||\n        canvasBottom < 0 ||\n        canvasLeft > runtimeGame.getGameResolutionWidth() ||\n        canvasTop > runtimeGame.getGameResolutionHeight();\n      if (isOutsideCanvas) {\n        this._input.style.display = 'none';\n        return;\n      }\n\n      // Position the input on the container on top of the canvas.\n      workingPoint[0] = canvasLeft;\n      workingPoint[1] = canvasTop;\n      runtimeGameRenderer.convertCanvasToDomElementContainerCoords(\n        workingPoint,\n        workingPoint\n      );\n      const pageLeft = workingPoint[0];\n      const pageTop = workingPoint[1];\n\n      workingPoint[0] = canvasRight;\n      workingPoint[1] = canvasBottom;\n      runtimeGameRenderer.convertCanvasToDomElementContainerCoords(\n        workingPoint,\n        workingPoint\n      );\n      const pageRight = workingPoint[0];\n      const pageBottom = workingPoint[1];\n\n      const widthInContainer = pageRight - pageLeft;\n      const heightInContainer = pageBottom - pageTop;\n\n      this._input.style.left = pageLeft + 'px';\n      this._input.style.top = pageTop + 'px';\n      this._input.style.width = widthInContainer + 'px';\n      this._input.style.height = heightInContainer + 'px';\n      this._input.style.transform =\n        'rotate3d(0,0,1,' + (this._object.getAngle() % 360) + 'deg)';\n\n      // Automatically adjust the font size to follow the game scale.\n      this._input.style.fontSize =\n        this._object.getFontSize() *\n          runtimeGameRenderer.getCanvasToDomElementContainerHeightScale() +\n        'px';\n\n      // Display after the object is positioned.\n      this._input.style.display = 'initial';\n    }\n\n    updateString() {\n      if (!this._input) return;\n      this._input.value = this._object.getString();\n    }\n\n    updatePlaceholder() {\n      if (!this._input) return;\n      this._input.placeholder = this._object.getPlaceholder();\n    }\n\n    updateFont() {\n      if (!this._input) return;\n      this._input.style.fontFamily = this._instanceContainer\n        .getGame()\n        .getFontManager()\n        .getFontFamily(this._object.getFontResourceName());\n    }\n\n    updateOpacity() {\n      if (!this._input) return;\n      this._input.style.opacity = '' + this._object.getOpacity() / 255;\n    }\n\n    updateInputType() {\n      if (!this._input) return;\n\n      const isTextArea = this._input instanceof HTMLTextAreaElement;\n      const shouldBeTextArea = this._object.getInputType() === 'text area';\n      if (isTextArea !== shouldBeTextArea) {\n        this._destroyElement();\n        this._createElement();\n      }\n\n      const newType =\n        userFriendlyToHtmlInputTypes[this._object.getInputType()] || 'text';\n      this._input.setAttribute('type', newType);\n    }\n\n    updateTextColor() {\n      if (!this._input) return;\n\n      this._input.style.color = formatRgbAndOpacityToCssRgba(\n        this._object._getRawTextColor(),\n        255\n      );\n    }\n\n    updateFillColorAndOpacity() {\n      if (!this._input) return;\n\n      this._input.style.backgroundColor = formatRgbAndOpacityToCssRgba(\n        this._object._getRawFillColor(),\n        this._object.getFillOpacity()\n      );\n    }\n\n    updateBorderColorAndOpacity() {\n      if (!this._input) return;\n\n      this._input.style.borderColor = formatRgbAndOpacityToCssRgba(\n        this._object._getRawBorderColor(),\n        this._object.getBorderOpacity()\n      );\n    }\n    updateBorderWidth() {\n      if (!this._input) return;\n\n      this._input.style.borderWidth = this._object.getBorderWidth() + 'px';\n    }\n    updateDisabled() {\n      if (!this._input) return;\n\n      this._input.disabled = this._object.isDisabled();\n    }\n    updateReadOnly() {\n      if (!this._input) return;\n\n      this._input.readOnly = this._object.isReadOnly();\n    }\n\n    isFocused() {\n      return this._input === document.activeElement;\n    }\n\n    focus() {\n      if (!this._input) return;\n\n      this._input.focus();\n    }\n  }\n\n  export const TextInputRuntimeObjectRenderer = TextInputRuntimeObjectPixiRenderer;\n  export type TextInputRuntimeObjectRenderer = TextInputRuntimeObjectPixiRenderer;\n}\n"],
  "mappings": "AAAA,GAAU,MAAV,UAAU,EAAV,CACE,KAAM,GAA+B,CACnC,KAAM,OACN,MAAO,QACP,SAAU,WACV,OAAQ,SACR,mBAAoB,MACpB,IAAK,MACL,OAAQ,UAGJ,EAA+B,CACnC,EACA,IAGE,QACA,EAAS,GACT,IACA,EAAS,GACT,IACA,EAAS,GACT,IACA,EAAU,IACV,IAIJ,OAAyC,CAMvC,YACE,EACA,EACA,CAPM,YAAwD,KAQ9D,KAAK,QAAU,EACf,KAAK,mBAAqB,EAC1B,KAAK,aAAe,KAAK,mBAAmB,UAE5C,KAAK,iBAGP,gBAAiB,CACf,GAAM,KAAK,OACT,KAAM,IAAI,OAAM,uDAElB,KAAM,GAAa,KAAK,QAAQ,iBAAmB,YACnD,KAAK,OAAS,SAAS,cAAc,EAAa,WAAa,SAC/D,KAAK,OAAO,MAAM,OAAS,kBAC3B,KAAK,OAAO,aAAe,MAC3B,KAAK,OAAO,MAAM,aAAe,MACjC,KAAK,OAAO,MAAM,gBAAkB,QACpC,KAAK,OAAO,MAAM,SAAW,WAC7B,KAAK,OAAO,MAAM,OAAS,OAC3B,KAAK,OAAO,MAAM,QAAU,OAC5B,KAAK,OAAO,MAAM,cAAgB,OAClC,KAAK,OAAO,MAAM,QAAU,OAC5B,KAAK,OAAO,MAAM,UAAY,aAE9B,KAAK,OAAO,iBAAiB,QAAS,IAAM,CAC1C,AAAI,CAAC,KAAK,QAEV,KAAK,QAAQ,4BAA4B,KAAK,OAAO,SAEvD,KAAK,OAAO,iBAAiB,aAAc,IAAM,CAC/C,AAAI,CAAC,KAAK,QAGN,SAAS,gBAAkB,KAAK,QAAQ,KAAK,OAAO,UAG1D,KAAK,eACL,KAAK,aACL,KAAK,oBACL,KAAK,gBACL,KAAK,kBACL,KAAK,kBACL,KAAK,4BACL,KAAK,8BACL,KAAK,oBACL,KAAK,iBACL,KAAK,iBAEL,KAAK,aACF,cACA,yBACA,YAAY,KAAK,QAGtB,iBAAkB,CAChB,AAAI,CAAC,KAAK,QACV,MAAK,OAAO,SACZ,KAAK,OAAS,MAGhB,eAAgB,CAMd,KAAK,kBAGP,gBAAiB,CACf,KAAK,iBAGP,WAAY,CACV,KAAK,kBAGP,iBAAkB,CAChB,GAAI,CAAC,KAAK,OAAQ,OAKlB,GAAI,KAAK,QAAQ,WAAY,CAC3B,KAAK,OAAO,MAAM,QAAU,OAC5B,OAMF,KAAM,GAAQ,KAAK,mBAAmB,SAAS,KAAK,QAAQ,YAC5D,GAAI,CAAC,EAAM,YAAa,CACtB,KAAK,OAAO,MAAM,QAAU,OAC5B,OAGF,KAAM,GAA2B,EAAK,YACpC,EAAmC,UAAU,iBAGzC,EAAc,KAAK,mBAAmB,UACtC,EAAsB,EAAY,cAClC,EAA2B,EAAM,qBACrC,KAAK,QAAQ,EACb,KAAK,QAAQ,EACb,EACA,GAEI,EAAa,EAAyB,GACtC,EAAY,EAAyB,GAErC,EAA+B,EAAM,qBACzC,KAAK,QAAQ,EAAI,KAAK,QAAQ,WAC9B,KAAK,QAAQ,EAAI,KAAK,QAAQ,YAC9B,EACA,GAEI,EAAc,EAA6B,GAC3C,EAAe,EAA6B,GAQlD,GAJE,EAAc,GACd,EAAe,GACf,EAAa,EAAY,0BACzB,EAAY,EAAY,0BACL,CACnB,KAAK,OAAO,MAAM,QAAU,OAC5B,OAIF,EAAa,GAAK,EAClB,EAAa,GAAK,EAClB,EAAoB,yCAClB,EACA,GAEF,KAAM,GAAW,EAAa,GACxB,EAAU,EAAa,GAE7B,EAAa,GAAK,EAClB,EAAa,GAAK,EAClB,EAAoB,yCAClB,EACA,GAEF,KAAM,GAAY,EAAa,GACzB,EAAa,EAAa,GAE1B,EAAmB,EAAY,EAC/B,EAAoB,EAAa,EAEvC,KAAK,OAAO,MAAM,KAAO,EAAW,KACpC,KAAK,OAAO,MAAM,IAAM,EAAU,KAClC,KAAK,OAAO,MAAM,MAAQ,EAAmB,KAC7C,KAAK,OAAO,MAAM,OAAS,EAAoB,KAC/C,KAAK,OAAO,MAAM,UAChB,kBAAqB,KAAK,QAAQ,WAAa,IAAO,OAGxD,KAAK,OAAO,MAAM,SAChB,KAAK,QAAQ,cACX,EAAoB,4CACtB,KAGF,KAAK,OAAO,MAAM,QAAU,UAG9B,cAAe,CACb,AAAI,CAAC,KAAK,QACV,MAAK,OAAO,MAAQ,KAAK,QAAQ,aAGnC,mBAAoB,CAClB,AAAI,CAAC,KAAK,QACV,MAAK,OAAO,YAAc,KAAK,QAAQ,kBAGzC,YAAa,CACX,AAAI,CAAC,KAAK,QACV,MAAK,OAAO,MAAM,WAAa,KAAK,mBACjC,UACA,iBACA,cAAc,KAAK,QAAQ,wBAGhC,eAAgB,CACd,AAAI,CAAC,KAAK,QACV,MAAK,OAAO,MAAM,QAAU,GAAK,KAAK,QAAQ,aAAe,KAG/D,iBAAkB,CAChB,GAAI,CAAC,KAAK,OAAQ,OAElB,KAAM,GAAa,KAAK,iBAAkB,qBACpC,EAAmB,KAAK,QAAQ,iBAAmB,YACzD,AAAI,IAAe,GACjB,MAAK,kBACL,KAAK,kBAGP,KAAM,GACJ,EAA6B,KAAK,QAAQ,iBAAmB,OAC/D,KAAK,OAAO,aAAa,OAAQ,GAGnC,iBAAkB,CAChB,AAAI,CAAC,KAAK,QAEV,MAAK,OAAO,MAAM,MAAQ,EACxB,KAAK,QAAQ,mBACb,MAIJ,2BAA4B,CAC1B,AAAI,CAAC,KAAK,QAEV,MAAK,OAAO,MAAM,gBAAkB,EAClC,KAAK,QAAQ,mBACb,KAAK,QAAQ,mBAIjB,6BAA8B,CAC5B,AAAI,CAAC,KAAK,QAEV,MAAK,OAAO,MAAM,YAAc,EAC9B,KAAK,QAAQ,qBACb,KAAK,QAAQ,qBAGjB,mBAAoB,CAClB,AAAI,CAAC,KAAK,QAEV,MAAK,OAAO,MAAM,YAAc,KAAK,QAAQ,iBAAmB,MAElE,gBAAiB,CACf,AAAI,CAAC,KAAK,QAEV,MAAK,OAAO,SAAW,KAAK,QAAQ,cAEtC,gBAAiB,CACf,AAAI,CAAC,KAAK,QAEV,MAAK,OAAO,SAAW,KAAK,QAAQ,cAGtC,WAAY,CACV,MAAO,MAAK,SAAW,SAAS,cAGlC,OAAQ,CACN,AAAI,CAAC,KAAK,QAEV,KAAK,OAAO,SAIT,AAAM,iCAAiC,IA5StC",
  "names": []
}
