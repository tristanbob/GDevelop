var gdjs;(function(t){const l=new t.Logger("Facebook instant games");let p;(function(u){let y;(function(d){if(d._preloadedInterstitial=null,d._preloadedInterstitialLoading=!1,d._preloadedInterstitialLoaded=!1,d._preloadedRewardedVideo=null,d._preloadedRewardedVideoLoading=!1,d._preloadedRewardedVideoLoaded=!1,d.areAdsSupported=function(){if(typeof FBInstant=="undefined")return!1;const o=FBInstant.getSupportedAPIs();return o.indexOf("getInterstitialAdAsync")!==-1&&o.indexOf("getRewardedVideoAsync")!==-1},d.getPlayerId=function(){return typeof FBInstant=="undefined"?"":FBInstant.player.getID()||""},d.getPlayerName=function(){return typeof FBInstant=="undefined"?"":FBInstant.player.getName()||""},d.loadPlayerData=function(o,r,n){typeof FBInstant!="undefined"&&(n.setString(""),r.setString(""),FBInstant.player.getDataAsync([o]).then(function(i){r.fromJSON(i[o])}).catch(function(i){n.setString(i.message||"Unknown error")}))},d.setPlayerData=function(o,r,n,i){if(typeof FBInstant=="undefined")return;i.setString(""),n.setString("");const a={};a[o]=JSON.stringify(r.toJSObject()),FBInstant.player.setDataAsync(a).then(function(){n.setString("Player data saved")}).catch(function(e){i.setString(e.message||"Unknown error")})},d.setPlayerScore=function(o,r,n,i,a){if(typeof FBInstant=="undefined")return;a.setString(""),i.setString("");const e=JSON.stringify(n.toJSObject());FBInstant.getLeaderboardAsync(o).then(function(s){return s.setScoreAsync(r,e)}).then(function(){i.setString("Player score saved")}).catch(function(s){a.setString(s.message||"Unknown error")})},d.getPlayerEntry=function(o,r,n,i,a){typeof FBInstant!="undefined"&&(a.setString(""),i.setString(""),FBInstant.getLeaderboardAsync(o).then(function(e){return e.getPlayerEntryAsync()}).then(function(e){r.setNumber(e.getRank()===null?-1:e.getRank()),n.setNumber(e.getScore()===null?-1:e.getScore()),i.fromJSON(e.getExtraData())}).catch(function(e){a.setString(e.message||"Unknown error")}))},d.loadInterstitialAd=function(o,r){typeof FBInstant!="undefined"&&(t.evtTools.facebookInstantGames._preloadedInterstitialLoading||t.evtTools.facebookInstantGames._preloadedInterstitialLoaded||(t.evtTools.facebookInstantGames._preloadedInterstitialLoading=!0,FBInstant.getInterstitialAdAsync(o).then(function(n){return t.evtTools.facebookInstantGames._preloadedInterstitial=n,n.loadAsync()}).then(function(){t.evtTools.facebookInstantGames._preloadedInterstitialLoading=!1,t.evtTools.facebookInstantGames._preloadedInterstitialLoaded=!0,l.info("Facebook Instant Games interstitial preloaded.")}).catch(function(n){t.evtTools.facebookInstantGames._preloadedInterstitialLoading=!1,t.evtTools.facebookInstantGames._preloadedInterstitialLoaded=!1,l.error("Interstitial failed to preload: "+n.message),r.setString(n.message||"Unknown error")})))},d.showInterstitialAd=function(o){typeof FBInstant!="undefined"&&(!t.evtTools.facebookInstantGames._preloadedInterstitialLoaded||t.evtTools.facebookInstantGames._preloadedInterstitial.showAsync().then(function(){l.info("Facebook Instant Games interstitial shown.")}).catch(function(r){l.error("Interstitial failed to show: "+r.message),o.setString(r.message||"Unknown error")}).then(function(){t.evtTools.facebookInstantGames._preloadedInterstitialLoaded=!1}))},d.isInterstitialAdReady=function(){return t.evtTools.facebookInstantGames._preloadedInterstitialLoaded},d.loadRewardedVideo=function(o,r){typeof FBInstant!="undefined"&&(t.evtTools.facebookInstantGames._preloadedRewardedVideoLoading||t.evtTools.facebookInstantGames._preloadedRewardedVideoLoaded||(t.evtTools.facebookInstantGames._preloadedRewardedVideoLoading=!0,FBInstant.getRewardedVideoAsync(o).then(function(n){return t.evtTools.facebookInstantGames._preloadedRewardedVideo=n,n.loadAsync()}).then(function(){t.evtTools.facebookInstantGames._preloadedRewardedVideoLoading=!1,t.evtTools.facebookInstantGames._preloadedRewardedVideoLoaded=!0,l.info("Facebook Instant Games rewarded video preloaded.")}).catch(function(n){t.evtTools.facebookInstantGames._preloadedRewardedVideoLoading=!1,t.evtTools.facebookInstantGames._preloadedRewardedVideoLoaded=!1,l.error("Rewarded video failed to preload: "+n.message),r.setString(n.message||"Unknown error")})))},d.showRewardedVideo=function(o){typeof FBInstant!="undefined"&&(!t.evtTools.facebookInstantGames._preloadedRewardedVideoLoaded||t.evtTools.facebookInstantGames._preloadedRewardedVideo.showAsync().then(function(){l.info("Facebook Instant Games rewarded video shown.")}).catch(function(r){l.error("Rewarded video failed to show: "+r.message),o.setString(r.message||"Unknown error")}).then(function(){t.evtTools.facebookInstantGames._preloadedRewardedVideoLoaded=!1}))},d.isRewardedVideoReady=function(){return t.evtTools.facebookInstantGames._preloadedRewardedVideoLoaded},typeof FBInstant=="undefined"&&typeof window!="undefined"){l.log("Creating a mocked version of Facebook Instant Games.");class o{constructor(){this._playerScore=null;this._playerRank=null;this._playerExtraData=null}setScoreAsync(s,c){const f=this;return new Promise(function(g){f._playerScore=s,f._playerRank=1,f._playerExtraData=c,g()})}getPlayerEntryAsync(){const s=this;return new Promise(function(c){c({getScore:function(){return s._playerScore},getRank:function(){return s._playerRank},getExtraData:function(){return s._playerExtraData}})})}}class r{constructor(){this._isLoaded=!1}loadAsync(){return this._isLoaded=!0,Promise.resolve()}showAsync(){return this._isLoaded?(l.info("In a real Instant Game, a video reward should have been shown to the user."),Promise.resolve()):Promise.reject(new Error("Rewarded video is not loaded."))}}class n{constructor(){this._isLoaded=!1}loadAsync(){return this._isLoaded=!0,Promise.resolve()}showAsync(){return this._isLoaded?(l.info("In a real Instant Game, an interstitial should have been shown to the user."),Promise.resolve()):Promise.reject(new Error("Interstitial is not loaded."))}}const i=[],a={_mockedPlayerData:{},_mockedLeaderboards:{},player:{getName:function(){return"Fake player name"},getID:function(){return"12345678"},getDataAsync:function(e){return new Promise(function(s){s(a._mockedPlayerData)})},setDataAsync:function(e){return new Promise(function(s){a._mockedPlayerData=e,s()})}},getLeaderboardAsync:function(e){return new Promise(function(s){a._mockedLeaderboards[e]=a._mockedLeaderboards[e]||new o,s(a._mockedLeaderboards[e])})},getInterstitialAdAsync:function(){return Promise.resolve(new n)},getRewardedVideoAsync:function(){return Promise.resolve(new r)},getSupportedAPIs:function(){return i}};for(const e in a)if(typeof a[e]=="object")for(const s in a[e])typeof a[e][s]=="function"&&i.push(e+"."+s);else typeof a[e]=="function"&&i.push(e);window.FBInstant=a}})(y=u.facebookInstantGames||(u.facebookInstantGames={}))})(p=t.evtTools||(t.evtTools={}))})(gdjs||(gdjs={}));
//# sourceMappingURL=facebookinstantgamestools.js.map
