var gdjs;(function(i){const h=a=>{a.metalness&&(a.metalness=0)},b=a=>{const e=a;if(!!e.material)if(Array.isArray(e.material))for(let t=0;t<e.material.length;t++)h(e.material[t]);else h(e.material)},E=a=>a.traverse(b),R=a=>{const e=new THREE.MeshBasicMaterial;return a.color&&(e.color=a.color),a.map&&(e.map=a.map),e},j=a=>{const e=a;if(!!e.material)if(Array.isArray(e.material))for(let t=0;t<e.material.length;t++)e.material[t]=R(e.material[t]);else e.material=R(e.material)},O=a=>a.traverse(j);class _ extends i.RuntimeObject3DRenderer{constructor(e,t){const n=t.getGame().getModel3DManager().getModel(e._modelResourceName),s=THREE_ADDONS.SkeletonUtils.clone(n),r=new THREE.Group;r.rotation.order="ZYX",r.add(s);super(e,t,r);this._model3DRuntimeObject=e,this._threeObject=s,this.updateSize(),this.updatePosition(),this.updateRotation()}_updateDefaultTransformation(e,t,n,s,r,D,u){const o=this._getModelAABB(e,t,n);this._threeObject.position.set(-(o.min.x+o.max.x)/2,this._threeObject.position.y=-(o.min.y+o.max.y)/2,this._threeObject.position.z=-(o.min.z+o.max.z)/2),this._threeObject.scale.set(1,1,1),this._threeObject.rotation.set(i.toRad(e),i.toRad(t),i.toRad(n));const l=o.max.x-o.min.x,c=o.max.y-o.min.y,m=o.max.z-o.min.z,p=1/l,g=1/c,T=1/m,M=new THREE.Matrix4;if(M.makeScale(p,g,T),this._threeObject.updateMatrix(),this._threeObject.applyMatrix4(M),u){const H=s/l,f=r/c,x=D/m,d=Math.min(H,f,x);this._object._setOriginalWidth(d*l),this._object._setOriginalHeight(d*c),this._object._setOriginalDepth(d*m)}this._threeObject.updateMatrix()}_getModelAABB(e,t,n){const s=this._object.getInstanceContainer().getGame().getModel3DManager().getModel(this._model3DRuntimeObject._modelResourceName);s.rotation.set(i.toRad(e),i.toRad(t),i.toRad(n));const r=new THREE.Box3().setFromObject(s);return s.rotation.set(0,0,0),r}_updateMaterials(){const e=this._model3DRuntimeObject.getInstanceContainer().getGame().getModel3DManager().getModel(this._model3DRuntimeObject._modelResourceName),t=THREE_ADDONS.SkeletonUtils.clone(e);this.get3DRendererObject().remove(this._threeObject),this.get3DRendererObject().add(t),this._threeObject=t,this._replaceMaterials()}_replaceMaterials(){this._model3DRuntimeObject._materialType===i.Model3DRuntimeObject.MaterialType.StandardWithoutMetalness?E(this._threeObject):this._model3DRuntimeObject._materialType===i.Model3DRuntimeObject.MaterialType.Basic&&O(this._threeObject)}}i.Model3DRuntimeObjectRenderer=_})(gdjs||(gdjs={}));
//# sourceMappingURL=Model3DRuntimeObject3DRenderer.js.map
